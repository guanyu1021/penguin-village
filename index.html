<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>æ²™ç›¤å¯¦æ³ - æª¢è¦–é é¢</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <style>
        .grid-cell { width: 22px; height: 22px; border: 0.1px solid #444; font-size: 10px; display: flex; align-items: center; justify-content: center; }
        .cell-stone { background-color: #475569; color: white; border: 2px solid #1e293b; font-size: 14px; }
        .cell-item { background-color: #facc15; border: 1px solid #ca8a04; color: #854d0e; }
        #game-map { display: grid; grid-template-columns: repeat(32, 22px); background-color: #334155; padding: 4px; gap: 1px; }
    </style>
</head>
<body class="bg-slate-900 flex h-screen overflow-hidden">
    <div class="w-64 bg-slate-800 p-4 text-white overflow-y-auto shadow-2xl">
        <h1 class="text-xl font-bold text-yellow-400 mb-4 text-center">ğŸ† å³æ™‚æ’è¡Œæ¦œ</h1>
        <div id="score-board" class="space-y-2"></div>
    </div>
    <div class="flex-1 flex flex-col items-center justify-center">
        <div class="bg-blue-900 px-8 py-4 rounded-full text-white font-bold text-2xl mb-6 shadow-lg border-2 border-blue-400">
            ä¼éµæ‘å¾æœæˆ° - å¯¦æ³è½‰æ’­ä¸­
        </div>
        <div id="game-map" class="scale-110"></div>
    </div>

    <script>
        // === âš ï¸ è«‹åœ¨æ­¤å¡«å…¥èˆ‡ ADMIN ç›¸åŒçš„ FIREBASE CONFIG ===
        const firebaseConfig = {
            apiKey: "AIzaSyBBufDrt_ReM-5qLeQyJs2nXAwdMO_TbC4",
            authDomain: "sunflower-b5be6.firebaseapp.com",
            projectId: "sunflower-b5be6",
            storageBucket: "sunflower-b5be6.firebasestorage.app",
            messagingSenderId: "206261082118",
            appId: "1:206261082118:web:77e158bd61b287056a8b87",
            measurementId: "G-T477KW8R2L"
        };
        // ===============================================

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function init() {
            const mapEl = document.getElementById('game-map');
            for(let r=1; r<=32; r++) {
                for(let c=1; c<=32; c++) {
                    const cell = document.createElement('div');
                    cell.className = 'grid-cell';
                    cell.id = `v-${r}-${c}`;
                    mapEl.appendChild(cell);
                }
            }

            db.ref('gameData').on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) render(data);
            });
        }

        function render(data) {
            const { mapData, teamInfo } = data;
            // æ¸²æŸ“åœ°åœ–
            for(let r=1; r<=32; r++) {
                for(let c=1; c<=32; c++) {
                    const el = document.getElementById(`v-${r}-${c}`);
                    const cell = mapData[r][c];
                    el.className = 'grid-cell'; el.style.backgroundColor = ""; el.textContent = "";
                    if(cell) {
                        if(cell.type === 'stone') { el.classList.add('cell-stone'); el.textContent = "ğŸª¨"; }
                        else {
                            const t = teamInfo.find(ti => ti.id === cell.teamId);
                            el.style.backgroundColor = t.color;
                        }
                    }
                }
            }
            // æ¸²æŸ“æ’è¡Œæ¦œ (ä¾åˆ†æ•¸æ’åº)
            const sorted = [...teamInfo].sort((a,b) => b.score - a.score);
            document.getElementById('score-board').innerHTML = sorted.map((t, i) => `
                <div class="flex justify-between items-center p-2 bg-slate-700 rounded border-l-4" style="border-color:${t.color}">
                    <span class="text-sm font-bold">${i+1}. ${t.id}</span>
                    <span class="text-lg">${t.score}</span>
                </div>
            `).join('');
        }
        init();
    </script>
</body>
</html>
